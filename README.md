# 股票交易系统

一个完整的股票交易系统，包含数据获取、特征工程、预测模型、回测引擎、风险管理、交易执行和可视化等模块。

## 项目概述

这个股票交易系统旨在提供从数据获取到策略执行的全流程解决方案，帮助用户开发、测试和部署交易策略。系统采用模块化设计，各组件之间松耦合，可以根据需求灵活配置和扩展。系统特色包括多数据源集成、强大的可视化界面和智能的容错处理机制。

## 主要功能

- **数据获取**：集成多个数据源（如Tushare、AkShare），支持A股真实数据获取，包含自动列名映射和容错处理
- **特征工程**：提供技术指标计算、基本面因子提取和情感分析等功能
- **预测模型**：支持多种机器学习模型，用于股票价格和趋势预测
- **回测引擎**：提供高效的策略回测功能，支持多种交易策略和绩效评估
- **风险管理**：包括风险指标计算、投资组合优化和回撤管理等功能
- **交易执行**：支持模拟交易和实盘交易
- **可视化界面**：基于Streamlit的交互式Web应用，提供丰富的数据展示和分析功能

## 目录结构

```
├── config/             # 配置文件目录
│   ├── config.yaml     # 主配置文件
│   └── logging.yaml    # 日志配置文件
├── data/               # 数据存储目录
├── docs/               # 文档目录
├── examples/           # 示例代码
├── logs/               # 日志文件目录
├── models/             # 模型存储目录
├── src/                # 源代码目录
│   ├── backtesting_engine/  # 回测引擎模块
│   ├── data_acquisition/    # 数据获取模块
│   ├── feature_engineering/ # 特征工程模块
│   ├── prediction_model/    # 预测模型模块
│   ├── risk_management/     # 风险管理模块
│   ├── trading_execution/   # 交易执行模块
│   └── visualization/       # 可视化模块
├── test/               # 测试代码
├── main.py             # 主程序入口
└── requirements.txt    # 依赖包列表
```

## 安装指南

1. **克隆仓库**
   ```bash
   git clone https://github.com/guts-yang/stocktrader.git
   cd stocktrader
   ```

2. **创建虚拟环境**
   ```bash
   python -m venv venv
   source venv/bin/activate  # Windows: venv\Scripts\activate
   ```

3. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

4. **配置API密钥**
   在`config/config.yaml`文件中配置数据源的API密钥

## 使用方法

系统提供了命令行接口和可视化界面两种使用方式。

### 可视化界面

**启动方法**：
```bash
cd src/visualization
streamlit run visualization_app.py
```

**主要功能**：
- 输入股票代码查询A股历史行情真实数据
- 选择日期范围和数据频率
- 显示K线图、均线和成交量等技术图表
- 进行风险指标分析（总收益率、年化收益率、波动率、夏普比率、最大回撤等）
- 查看AI模型生成的价格预测结果和涨跌概率
- 导出数据为CSV格式

**操作流程**：
1. 在侧边栏输入股票代码（6位数字）
2. 选择查询的日期范围
3. 选择需要显示的技术指标和分析选项
4. 点击"执行分析"按钮
5. 查看主界面展示的各种图表和分析结果
6. 需要时可下载数据或调整参数重新分析

**数据源处理特点**：
- 自动从Tushare获取A股真实数据，当Tushare不可用时自动切换到AkShare作为备选
- 智能处理不同数据源的列名差异（如'trade_date'/'日期'/'datetime'、'vol'/'成交量'等）
- 包含'volume'字段的特殊处理和容错机制，确保成交量图表正常显示
- 支持多种数据列名映射，提高系统兼容性

### 命令行接口

可以通过`main.py`文件调用各种功能。

#### 运行示例

```bash
python main.py example --example backtest_example
```

#### 运行策略回测

```bash
python main.py backtest --strategy ma_cross --capital 100000 --report results/ma_cross_backtest
```

#### 进行风险分析

```bash
python main.py risk --data-file data/stock_data.csv --report results/risk_analysis
```

#### 优化投资组合

```bash
python main.py portfolio --method max_sharpe --report results/portfolio_optimization
```

## 模块详细说明

### 1. 回测引擎 (backtesting_engine)

回测引擎提供了完整的策略回测功能，包括：
- 数据处理和加载
- 多种交易策略实现
- 订单管理和执行模拟
- 绩效分析和可视化
- 统计分析和蒙特卡洛模拟

### 2. 风险管理 (risk_management)

风险管理模块提供了全面的风险评估和管理工具：
- 风险指标计算（波动率、VaR、CVaR等）
- 投资组合优化（均值-方差、风险平价、最大夏普率）
- 回撤管理和预警
- 压力测试

### 3. 数据获取 (data_acquisition)

数据获取模块负责从各种数据源获取和处理数据：
- 历史行情数据获取
- 基本面数据获取
- 数据清洗和预处理
- 数据缓存和管理

### 4. 特征工程 (feature_engineering)

特征工程模块提供了丰富的特征提取和处理功能：
- 技术指标计算
- 基本面因子提取
- 特征选择和降维
- 特征标准化和归一化

### 5. 预测模型 (prediction_model)

预测模型模块负责训练和应用机器学习模型进行预测：
- 多种模型支持（LSTM、Transformer等）
- 模型训练和评估
- 模型保存和加载
- 预测结果生成

### 6. 交易执行 (trading_execution)

交易执行模块负责连接交易接口并执行交易：
- 模拟交易和实盘交易支持
- 订单管理和执行
- 仓位跟踪和管理
- 交易日志记录

### 7. 可视化 (visualization)

可视化模块提供了直观的用户界面和丰富的图表展示功能：
- **交互式可视化界面**：基于Streamlit的Web应用，支持股票代码输入、数据查询和分析
- **价格走势图**：K线图、均线、成交量等技术图表
- **风险分析可视化**：风险指标卡片、回撤分析图表
- **预测结果展示**：AI模型预测结果和涨跌概率分布
- **数据导出功能**：支持CSV格式数据下载
- **响应式设计**：适配不同屏幕尺寸的设备
- **多数据源支持**：集成Tushare和AkShare，支持A股真实数据获取
- **智能列名映射**：自动处理不同数据源的列名差异（如日期、开盘价、最高价、最低价、收盘价和成交量等字段的多种可能命名）
- **容错机制**：包含数据缺失处理和错误回退机制，提高系统稳定性

## 配置说明

系统的主要配置位于`config/config.yaml`文件中，包括：

- **数据源配置**：API密钥、缓存设置等
- **数据库配置**：数据库类型、路径等
- **数据处理配置**：日期范围、填充方法等
- **特征工程配置**：技术指标、因子等
- **模型配置**：模型类型、参数等
- **回测引擎配置**：初始资金、佣金、滑点等
- **风险管理配置**：风险指标参数、优化方法等
- **实盘交易配置**：交易模式、平台信息等

## 开发指南

1. **代码规范**
   - 遵循PEP 8代码规范
   - 使用类型注解
   - 添加适当的文档字符串

2. **添加新功能**
   - 在相应模块目录下创建新文件
   - 实现功能类和方法
   - 添加测试代码
   - 更新配置文件和文档

3. **测试**
   - 编写单元测试和集成测试
   - 使用模拟数据验证功能
   - 进行性能测试

## 注意事项

- 回测结果不代表未来表现
- 实盘交易存在风险，请谨慎操作
- 定期更新数据源API密钥
- 保持系统和依赖包更新

## 许可证

[MIT License](LICENSE)

## 免责声明

本系统仅供学习和研究使用，不构成任何投资建议。使用本系统进行投资决策所产生的风险和损失，作者不承担任何责任。